# Generating User Profile Image URLs

Are you building an app and want to collect profile images from your users? Uploading a profile image during registration can be a pain point for a lot of users, and even developers. Whether you don't want to manage thousands of user photos or you don't want to bother your users to choose a photo when they register, a website called Gravatar is here to help.

Gravatar (globally recognized avatar) is a site where anyone can go and upload a photo to be used as their _GLOBALLY RECOGNIZED AVATAR_ and associated it with their email address. Here's how it works...

1. Any person who wants a gravatar signs up for [Gravatar](https://en.gravatar.com/) and uploads their avatar
1. They then visit some other website and create an account 
1. The code on the website checks with gravatar to see if there is an image associated with the email address
1. The website now has a url to the user's image and they never had to upload anything, and the site's developers don't need to host the image themselves.

## How do sites know the image url?

Assuming your application has just collected a user's email address, here is how it can grab that user's avatar

1. Start with this base URL `https://s.gravatar.com/avatar/`
1. Take the email and put it through a md5 hash function (we'll explain this part later)
    ```
    const email = "adam.sheaffer@nashvillesoftwareschool.com"
    const hashedEmail = md5(email);      // returned value: 094b3d769ccde6c3c9c16dbbb76dede0 
    ```
1. Add the hashed email onto the end of the base URL. Ex: https://s.gravatar.com/avatar/094b3d769ccde6c3c9c16dbbb76dede0
1. _Optional_: Add a query string parameter at the end to specify the pixel size of the image. Ex: https://s.gravatar.com/avatar/094b3d769ccde6c3c9c16dbbb76dede0?s=600

It may come as a shock to you, but not everyone on earth has created a gravatar. If you go through that process and there was no avatar associated with the email, the outputted url will return a default image. The following URL was generated by an email address that does not have a gravatar: https://s.gravatar.com/avatar/63900d012af98b4dc83e9a62909fb9b7?s=600

## Choose your own default image

Don't like the default gravatar image? As the developer you can specify your own fallback image URL. At the end of your gravatar url add `&d=YOUR_FALLBACK_IMAGE_URL_HERE`. Example:

https://s.gravatar.com/avatar/63900d012af98b4dc83e9a62909fb9b7?s=600&d=https://nss-day-cohort-32.github.io/images/nsslogo.png


## Hashing Email Addresses

Hashing is like encyption but it's only one-way--meaning we could take a piece of text like `"Hello World"`, put it through a hashing algorithm and get back the string `"b10a8db164e0754105b7a99be72e3fe5"`. And we could put the string `"Hello World"` through the hashing algorithm again and again and we'd always get the same result. We _can't_ however take the hashed string and decrypt it back to the original "Hello World"

If that didn't make any sense, don't worry! It's not important that you know how hashing works or what it even is to be able to use it for this purpose. It is important though that you create a function that will generate the hash. Create a folder somewhere in your project and name it `Utils` and add a file called `HashUtils`. Give it the following code

> HashUtils.cs

```csharp
public class HashUtils
{
    public static string MD5(string input)
    {
        MD5 md5 = System.Security.Cryptography.MD5.Create();
        byte[] inputBytes = Encoding.ASCII.GetBytes(input);
        byte[] hashBytes = md5.ComputeHash(inputBytes);

        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < hashBytes.Length; i++)
        {
            sb.Append(hashBytes[i].ToString("X2"));
        }
        return sb.ToString();
    }
}
```

> Note: In a more reasonable language (like python) this would be done a single line of code

In the same `Utils` folder create another file called `Gravatar.cs` and give it the following code

> Gravatar.cs

```csharp
public class Gravatar
{
    public static string GetUrl(string email)
    {
        string emailHash = HashUtils.MD5(email.ToLower().Trim());

        return $"https://www.gravatar.com/avatar/{emailHash}".ToLower();
    }
}
```

Feel free to tweak the above code if you want to add the abilty to specify the image size or the fallback URL

## Conclusion

Now that you have a method that will get your users' image URLs, you're welcome to use this new `GetUrl` function wherever you want. You could call it when users register and save the URL into the database, or maybe use it in a computed property on your user model/viewmodel. It's up to you!